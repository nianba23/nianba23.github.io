var g=Object.defineProperty;var f=(s,e,t)=>e in s?g(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var i=(s,e,t)=>(f(s,typeof e!="symbol"?e+"":e,t),t);import{_ as x,h as p,a5 as _,j as I,o as l,c as h,k as c,O as d,F as S,E as H,t as C,I as v,a as L}from"./chunks/framework.oNtUbm1h.js";const u=Array(1e6).fill(1).map((s,e)=>({id:e+1,text:`第${e+1}条数据`}));class T{constructor(){i(this,"preloadCount",20);i(this,"screenHeight",0);i(this,"total",0);i(this,"items",[]);i(this,"itemHeight",10);i(this,"scrollTop",0);i(this,"fetchStartIndex",0);i(this,"fetchEndIndex",0);return this}init(e=100,t=10){this.screenHeight=e,this.itemHeight=t}get totalHeight(){return this.total*this.itemHeight}get translateY(){return this.scrollTop-this.scrollTop%this.itemHeight}get startIndex(){return Math.floor(this.scrollTop/this.itemHeight)}get showListCount(){return Math.ceil(this.screenHeight/this.itemHeight)}get showList(){const{startIndex:e,fetchStartIndex:t,showListCount:n,items:r}=this,a=e-t,o=r.slice(a,a+n+1);return o.length?o:Array(n).fill(1).map((V,m)=>({id:m+1,text:"loading..."}))}getFetchIndex(){const e=Math.max(0,this.startIndex-this.preloadCount),t=Math.min(this.total,this.startIndex+this.showListCount+this.preloadCount);return[e,t]}fetchItem(){const[e,t]=this.getFetchIndex();this.timerId&&clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.total=u.length,this.items=u.slice(e,t),this.fetchStartIndex=e,this.fetchEndIndex=t,console.log("fetchItem")},100)}handleScroll(e){requestAnimationFrame(()=>{const{scrollTop:t}=e.target;if(t+this.screenHeight>this.totalHeight){console.log("到底了");return}this.scrollTop=t;const n=this.startIndex<this.fetchStartIndex+this.preloadCount/2,r=this.startIndex+this.showListCount>this.fetchEndIndex-this.preloadCount/2;n&&this.fetchStartIndex?this.fetchItem():r&&this.fetchEndIndex!==this.total&&this.fetchItem()})}}const w=["data-index"],y={__name:"VirtualList",setup(s){const e=p(null),t=_(new T);return I(()=>{const{height:n}=e.value.getBoundingClientRect();t.init(n,60),t.fetchItem()}),(n,r)=>(l(),h("div",{ref_key:"listRef",ref:e,class:"virtual-list-container",onScroll:r[0]||(r[0]=(...a)=>t.handleScroll&&t.handleScroll(...a))},[c("div",{style:d({height:`${t.totalHeight}px`})},[c("ul",{class:"list",style:d({transform:`translateY(${t.translateY}px)`})},[(l(!0),h(S,null,H(t.showList,(a,o)=>(l(),h("li",{key:a.id,"data-index":o,class:"item"},C(a.text),9,w))),128))],4)],4)],544))}},E=x(y,[["__scopeId","data-v-5bc86c74"]]),k=c("h1",{id:"虚拟列表",tabindex:"-1"},[L("虚拟列表 "),c("a",{class:"header-anchor",href:"#虚拟列表","aria-label":'Permalink to "虚拟列表"'},"​")],-1),b=JSON.parse('{"title":"虚拟列表","description":"","frontmatter":{},"headers":[],"relativePath":"guild/components/virtual-list/index.md","filePath":"guild/components/virtual-list/index.md"}'),M={name:"guild/components/virtual-list/index.md"},B=Object.assign(M,{setup(s){return(e,t)=>(l(),h("div",null,[k,v(E)]))}});export{b as __pageData,B as default};
